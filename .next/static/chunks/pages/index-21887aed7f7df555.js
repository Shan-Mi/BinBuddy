(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return i(4939)}])},4939:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return BinBuddy}});var n=i(5893),a=i(7294),s=i(8627),r=i(4937),d=i(800),l=i(3796),o=i(1239),p=i(1466),c=i(6953),x=i(9769),h=i(3299);let getSwedishWeekNumber=e=>{let t=new Date(e);t.setHours(0,0,0,0),t.setDate(t.getDate()+4-(t.getDay()||7));let i=new Date(t.getFullYear(),0,1),n=Math.ceil(((t.getTime()-i.getTime())/864e5+1)/7);return n};function BinBuddy(){let{data:e}=(0,h.useSession)(),[t,i]=(0,a.useState)([]),[m,f]=(0,a.useState)([]),[g,u]=(0,a.useState)("Reminder: \uD83D\uDDD1️ Please pull out the garbage before Tuesday 6:00AM. Thanks! \uD83D\uDC9C"),y=getSwedishWeekNumber(new Date);(0,a.useEffect)(()=>{let fetchAssignments=async()=>{let e=await fetch("/api/week-assignment"),t=await e.json(),n=await fetch("/api/swaps?week=".concat(y)),a=await n.json();f(a),i(t)};fetchAssignments()},[y]);let handleDragEnd=async i=>{if(!i.destination||!e)return;let n=i.source.index,a=i.destination.index,s=y+1;try{let e=await fetch("/api/swaps",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fromFamilyId:t[n].family.id,toFamilyId:t[a].family.id,weekNumber:s})});if(e.ok){let t=await e.json();f([...m,t]),alert("Swap request sent! Approval required from both families.")}}catch(e){console.error("Error proposing swap:",e)}},handleSwapApproval=async(e,t)=>{try{let i=await fetch("/api/swaps",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({swapId:e,status:t?"APPROVED":"REJECTED"})});if(i.ok){let n=await i.json();if(f(m.map(t=>t.id===e?n:t)),t){let e=await fetch("/api/swaps?week=".concat(y));f(await e.json())}}}catch(e){console.error("Error updating swap:",e)}},sendReminder=async e=>{try{let t=await fetch("/api/send-reminder",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({family:e,message:g})});if(!t.ok)throw Error("Failed to send reminder");alert("Reminder sent successfully!")}catch(e){console.error("Error sending reminder:",e),alert("Error sending reminder")}},w=t.filter(e=>e.week>=y).sort((e,t)=>e.week-t.week);return(0,n.jsxs)("div",{style:{margin:"0 auto"},children:[(0,n.jsxs)("h1",{style:{fontSize:"32px",fontWeight:"bold",textAlign:"center",marginBottom:"24px",position:"sticky",top:"0",backgroundColor:"#fff",zIndex:1,padding:"8px 0",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)"},children:["\uD83D\uDDD1️ BinBuddy - Week ",y]}),(0,n.jsx)(r.Z,{style:{marginBottom:"24px",padding:"16px"},children:(0,n.jsxs)(d.Z,{style:{padding:"16px"},children:[(0,n.jsx)("div",{style:{marginBottom:"24px"},children:(0,n.jsx)(l.Z,{fullWidth:!0,label:"Reminder Message",value:g,onChange:e=>u(e.target.value),variant:"outlined",multiline:!0,sx:{"@media (max-width: 600px)":{fontSize:"16px"}}})}),(0,n.jsx)(s.Z5,{onDragEnd:handleDragEnd,children:(0,n.jsx)(s.bK,{droppableId:"families",children:t=>(0,n.jsxs)("div",{...t.droppableProps,ref:t.innerRef,children:[w.map((t,i)=>{let{family:a,week:d}=t,l=m.find(e=>[e.fromFamilyId,e.toFamilyId].includes(a.id)&&"PENDING"===e.status);return(0,n.jsx)(s._l,{draggableId:a.id,index:i,isDragDisabled:!e,children:e=>(0,n.jsx)(r.Z,{ref:e.innerRef,...e.draggableProps,style:{...e.draggableProps.style,marginBottom:"16px",padding:"16px",border:"1px solid #ddd",borderRadius:"8px",backgroundColor:d===y?"#f0af4d":"#f9f9f9"},children:(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,n.jsx)("div",{...e.dragHandleProps,children:(0,n.jsx)(p.Z,{style:{marginRight:"16px"}})}),(0,n.jsxs)("div",{style:{flexGrow:1},children:[(0,n.jsxs)("h2",{style:{fontSize:"20px",fontWeight:"600",marginBottom:"8px"},children:[a.name," V",d,l&&(0,n.jsx)("span",{style:{color:"#ffa726",fontSize:"14px",marginLeft:"8px"},children:"(Swap Requested)"})]}),(0,n.jsxs)("p",{style:{fontSize:"14px",color:"#555",display:"flex",alignItems:"center",marginBottom:"8px"},children:[(0,n.jsx)(c.Z,{style:{width:"16px",height:"16px",marginRight:"8px"}}),a.email]}),(0,n.jsxs)("p",{style:{fontSize:"14px",color:"#555",display:"flex",alignItems:"center",marginBottom:"16px"},children:[(0,n.jsx)(x.Z,{style:{width:"16px",height:"16px",marginRight:"8px"}}),a.phone]})]}),(0,n.jsx)(o.Z,{onClick:()=>sendReminder(a),style:{padding:"8px 16px"},children:"Send Now"})]})})},a.id)}),t.placeholder]})})})]})}),e&&(0,n.jsx)(r.Z,{style:{padding:"16px",marginBottom:"24px"},children:(0,n.jsxs)(d.Z,{children:[(0,n.jsx)("h3",{style:{fontSize:"20px",marginBottom:"16px"},children:"Pending Swap Requests"}),m.filter(t=>"PENDING"===t.status&&[t.fromFamilyId,t.toFamilyId].includes(e.user.familyId)).map(e=>(0,n.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"12px",padding:"12px",border:"1px solid #eee",borderRadius:"8px"},children:(0,n.jsxs)("div",{children:[(0,n.jsx)(o.Z,{variant:"contained",color:"success",size:"small",onClick:()=>handleSwapApproval(e.id,!0),style:{marginRight:"8px"},children:"Approve"}),(0,n.jsx)(o.Z,{variant:"outlined",color:"error",size:"small",onClick:()=>handleSwapApproval(e.id,!1),children:"Reject"})]})},e.id))]})})]})}}},function(e){e.O(0,[62,350,774,888,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);